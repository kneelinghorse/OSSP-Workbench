asyncapi: '2.6.0'
info:
  title: Customer Profile Events
  version: '1.4.0'
  description: AsyncAPI demo spec for generating Kafka consumer code with governance annotations.

channels:
  customer.events.profile-updated:
    description: Customer profile update stream
    bindings:
      kafka:
        topic: customer.events.profile-updated
        partitions: 6
        configs:
          retry.backoff.ms: 2000
          retries: 5
          dead.letter.queue.topic.name: customer.events.profile-updated.dlq
    subscribe:
      operationId: consumeCustomerProfileUpdated
      message:
        $ref: '#/components/messages/customerProfileUpdated'
    x-subscribers:
      - analytics-service
      - crm-service
      - risk-service
      - support-service

components:
  messages:
    customerProfileUpdated:
      name: CustomerProfileUpdated
      title: Customer Profile Updated Event
      contentType: application/json
      payload:
        $ref: '#/components/schemas/customerProfileUpdatedPayload'
      x-delivery:
        transport: kafka
        retry_policy: exponential
        dlq: customer.events.profile-updated.dlq
        metadata:
          retry.backoff.ms: 2000

  schemas:
    customerProfileUpdatedPayload:
      type: object
      required:
        - user_id
        - updated_at
      properties:
        user_id:
          type: string
          description: Customer identifier
        updated_at:
          type: string
          format: date-time
        event_id:
          type: string
        email:
          type: string
          format: email
          description: Customer email address
        phone:
          type: string
          description: Customer phone number
        given_name:
          type: string
          description: Customer given name
        family_name:
          type: string
          description: Customer family name
        address_line_1:
          type: string
        city:
          type: string
        state:
          type: string
        postal_code:
          type: string
        marketing_opt_in:
          type: boolean
        loyalty_tier:
          type: string
